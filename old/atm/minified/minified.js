var utils=(()=>({onClick:function(e,n,a){var t=e.getMeshByName(n);return t.actionManager=new BABYLON.ActionManager(e),t.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,a)),t},moveTowards:function(e,n,a){var t=utils.normalize(utils.sum(n,utils.multiply(e,-1)));return{x:utils.moveTowardsScalar(e.x,n.x,Math.abs(a*t.x)),y:utils.moveTowardsScalar(e.y,n.y,Math.abs(a*t.y)),z:utils.moveTowardsScalar(e.z,n.z,Math.abs(a*t.z))}},moveTowardsScalar:function(e,n,a){var t=Math.sign(n-e),o=e+t*a;return Math.sign(n-o)!=t&&(o=n),o},normalize:function(e){return utils.divide(e,utils.magnitude(e))},magnitude:function(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)+Math.pow(e.z,2))},multiply:function(e,n){return{x:e.x*n,y:e.y*n,z:e.z*n}},divide:function(e,n){return{x:e.x/n,y:e.y/n,z:e.z/n}},sum:function(e,n){return{x:e.x+n.x,y:e.y+n.y,z:e.z+n.z}},lerp:function(e,n,a){return{x:utils.lerpScalar(e.x,n.x,a),y:utils.lerpScalar(e.y,n.y,a),z:utils.lerpScalar(e.z,n.z,a)}},lerpScalar:function(e,n,a){var t=Math.min(e,n),o=Math.max(e,n);return Math.max(t,Math.min(o,e+a*(n-e)))},equals:function(e,n){return e.x==n.x&&e.y==n.y&&e.z==n.z},set:function(e,n){n.x=e.x,n.y=e.y,n.z=e.z}}))(),cameraTargets={whole:{position:{x:0,y:1.9,z:-3},rotation:{x:.6109,y:0,z:0}},keyboard:{position:{x:0,y:.7867,z:-1.4951},rotation:{x:.6389,y:0,z:0}},screen:{position:{x:-.25,y:.7,z:-1.29},rotation:{x:.4211,y:0,z:0}}},asdf=5,game=(()=>{var numpadNames=["zero","one","two","three","four","five","six","seven","eight","nine"],usedScreens=["4","25","26","27","0","57","12","22","12","7","5","16","14","33","42","30","10","4","8","28","20","28","24","46","19","45","11","29","45","47","32","14","30","23","1","2","3","6","60"],amountPanel,screenTextures={},registerNumpadFunction=function(name,value,scene){var mesh=scene.getMeshByName(name);mesh.actionManager=new BABYLON.ActionManager(scene),mesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(){console.log("plick "+name),game.numbersPanel.isEnabled()&&(game.numbersPanel.button.textBlock.text+=game.hidePin?"X":value,game.numbersPanel.button.input||(game.numbersPanel.button.input=""),game.numbersPanel.button.input+=value,document.dispatchEvent(game.onNumpadInput)),game.amountPanel.isEnabled()&&(game.amountPanel.value||(game.amountPanel.value=""),game.amountPanel.value=eval(game.amountPanel.value+""+value),game.amountPanel.button.textBlock.text=(game.amountPanel.value/100).toFixed(2),document.dispatchEvent(game.onNumpadInput)),game.accountPanel.isEnabled()&&(game.accountPanel.button.textBlock.text+=value)}))},createButton=function(e,n,a,t="white"){var o=e.getMeshByName(n),r=BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(o),i=BABYLON.GUI.Button.CreateSimpleButton(a,"");return o.button=i,i.width=1,i.height=1,i.color=t,i.fontSize=100,r.addControl(i),o},setupLighting=function(e){var n=e.getLightByName("ambience light");n.intensity=2.5,new BABYLON.PointLight("DirectionalLight",new BABYLON.Vector3(0,1,-3),e).intensity=15,n.excludedMeshes.push(e.getMeshByName("pin"))},setupScreenMaterial=function(e){screenMaterial=new BABYLON.PBRMaterial("ScreenMaterial",e),(screen=e.getMeshByName("screen")).material=screenMaterial,screen.material.unlit=!0},goToScreen=function(e){screen.material.albedoTexture=screenTextures[e]},setupGreenThing=function(e){var n=e.getMeshByName("green thing");n.material=new BABYLON.StandardMaterial("green thing material",e),n.material.diffuseColor=new BABYLON.Color3(0,.1,0),n.material.alpha=.7},setupTouchButtons=function(e){game.invisibleMaterial=new BABYLON.StandardMaterial("touch buttons",e),game.invisibleMaterial.alpha=0;for(var n=0;n<4;n++){e.getMeshByName("touch r "+n).material=game.invisibleMaterial,e.getMeshByName("touch l "+n).material=game.invisibleMaterial}e.getMeshByName("receipt hitbox").material=e.getMeshByName("money out hitbox").material=e.getMeshByName("money in hitbox").material=e.getMeshByName("spitted money").material=game.invisibleMaterial,e.getMeshByName("spitted money").setEnabled(!1),e.getMeshByName("money in hitbox").setEnabled(!1)},cancelFunction=function(){!game.isCardInAnimationOver||game.capturedCard||game.blocked||flow.cancel()},erasePanels=function(){game.numbersPanel.button.textBlock.text="",game.numbersPanel.button.input="",game.amountPanel.value=0,game.amountPanel.button.textBlock.text="0.00"},initialize=function(e){for(var n=0;n<numpadNames.length;n++)registerNumpadFunction(numpadNames[n],n,e);flow.scene=e,game.card=e.getMeshByName("card"),game.card.actionManager=new BABYLON.ActionManager(e),game.card.stickInAction=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(){game.isCardInside||(game.isCardInside=!0,game.card.actionManager.actions=[],game.skeleton.beginAnimation("StickTheCard",!1,1,flow.initializeChip))}),game.card.actionManager.registerAction(game.card.stickInAction),game.numbersPanel=createButton(e,"numbers screen","but1"),game.amountPanel=createButton(e,"amount","amount button"),game.accountPanel=createButton(e,"account","account button"),game.quantityPanel=createButton(e,"quantity","quantity button","yellow"),game.multipliedPanel=createButton(e,"multiplied","multiplied button","yellow"),game.totalPanel=createButton(e,"total","total button","yellow"),setupLighting(e),setupScreenMaterial(e),setupGreenThing(e),setupTouchButtons(e),goToScreen("0"),game.numbersPanel.setEnabled(!1),game.amountPanel.setEnabled(!1),game.scene=e,game.skeleton=game.scene.getSkeletonByName("Armature"),game.cancelButton=utils.onClick(e,"cancel",cancelFunction),game.okButton=e.getMeshByName("ok"),game.eraseButton=utils.onClick(e,"erase",erasePanels),window.innerHeight<window.innerWidth?game.scene.cameras[0].fov=.6911:game.scene.cameras[0].fov=1.2},screenMaterial,screen,numbersPanel,preload=function(){for(var e=0;e<usedScreens.length;e++)screenTextures[usedScreens[e]]=new BABYLON.Texture("screens/"+usedScreens[e]+".png")},currentCameraTarget=cameraTargets.whole,transitionElapsed=0,lastTarget;return{onSceneLoad:function(e){preload(),initialize(e),game.scene.registerBeforeRender(()=>{lastTarget!=game.currentCameraTarget&&(transitionElapsed=0,lastTarget=game.currentCameraTarget);var e=utils.lerp(game.scene.cameras[0].position,game.currentCameraTarget.position,transitionElapsed/game.transitionDuration),n=utils.lerp(game.scene.cameras[0].rotation,game.currentCameraTarget.rotation,transitionElapsed/game.transitionDuration);utils.set(e,game.scene.cameras[0].position),utils.set(n,game.scene.cameras[0].rotation),transitionElapsed+=game.scene._engine._deltaTime/1e3})},transitionDuration:6,currentCameraTarget:currentCameraTarget,cameraTargets:cameraTargets,onNumpadInput:new Event("onNumpadInput"),screenMaterial:screenMaterial,screen:screen,goToScreen:goToScreen,cancelFunction:cancelFunction,wrongCode:0,isCardInside:!1,capturedCard:!1,isCardInAnimationOver:!1,blocked:!1,erasePanels:erasePanels,spitsMoney:!0,atmCode:"0000",changeAtmCode:"",screenTextures:screenTextures}})(),init=(()=>{var e=document.getElementById("renderCanvas"),n=null,a=null,t=null,o=function(){return new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1})};initFunction=async function(){if(!(n=await async function(){try{return o()}catch(e){return console.log("the available createEngine function failed. Creating the default engine instead"),o()}}()))throw"engine should not be null.";a=function(){var e=new BABYLON.Scene(n);return e.myStuff={},BABYLON.SceneLoader.Append("scenes/Atm/","atm.babylon",e,game.onSceneLoad),e}()},initFunction().then(()=>{t=a,n.runRenderLoop(function(){t&&t.activeCamera&&t.render()})}),window.addEventListener("resize",function(){n.resize(),window.innerHeight<window.innerWidth?game.scene.cameras[0].fov=.6911:game.scene.cameras[0].fov=1.2})})();console.log("it's ready! 0.23");var flow=(()=>{var e=function(e){return new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,e)},n={buttons:["touch r 1","touch r 2"],actions:[e(()=>{t()}),e(()=>b("4"))]},a=function(){game.numbersPanel.isEnabled()&&game.numbersPanel.button.input.length>=4&&("24"==flow.currentScreen.name?(game.changeAtmCode=game.numbersPanel.button.input,b("25")):"25"==flow.currentScreen.name&&(game.changeAtmCode==game.numbersPanel.button.input?(game.atmCode=game.changeAtmCode,b("26")):b("27")))},t=function(e=!0){game.isCardInside&&(game.isCardInside=!1,e&&b("0"),game.card.setEnabled(!0),game.skeleton.beginAnimation("UnstickTheCard",!1,1,function(){game.card.actionManager.registerAction(game.card.stickInAction),e||b("0")}))},o={buttons:["touch r 1","touch r 2"],actions:[e(function(){game.erasePanels()}),e(function(){!game.transference&&(0==game.amountPanel.value||game.amountPanel.value/100%10!=0||game.amountPanel.value/100>3e3)?b("57"):b("12")})],cameraTarget:cameraTargets.keyboard,requireAmount:!0,onQuit:function(){game.transference=!1}},r=n=>e(function(){game.currency=n,b("22")}),i=e(function(){b("12")}),c=function(){game.numbersPanel.isEnabled()&&game.numbersPanel.button.input.length>=4&&("0000"===game.numbersPanel.button.input?(b("7"),game.wrongCode=0):(b("5"),++game.wrongCode>=3&&(game.capturedCard=!0,B())))},u=function(){var e=flow.scene.getMeshByName("receipt hitbox"),n=flow.scene.getMeshByName("money out hitbox");e.actionManager.actions=[],n.actionManager.actions=[],game.skeleton.beginAnimation("retrieve receipt and money",!1,1,function(){game.spitsMoney=!0}),setTimeout(()=>{b("16")},1e3)},s=function(e){if(!e&&!game.spitsMoney)return game.spitsMoney=!0,void f();b("14"),flow.scene.getMeshByName("receipt").setEnabled(e),flow.scene.getMeshByName("receipt hitbox").setEnabled(e);flow.scene.getMeshByName("money out hitbox");flow.scene.getMeshByName("money out").setEnabled(game.spitsMoney),game.spitsMoney=!0,game.skeleton.beginAnimation("SpitMoneyAndReceipt",!1,1,m)},m=function(){var n=flow.scene.getMeshByName("receipt hitbox"),a=flow.scene.getMeshByName("money out hitbox");n.actionManager=new BABYLON.ActionManager(flow.scene),n.actionManager.registerAction(e(function(){u()})),a.actionManager=new BABYLON.ActionManager(flow.scene),a.actionManager.registerAction(e(function(){u()}))},g=()=>game.quickWhithdraw?(game.quickWhithdraw=!1,void b("19")):game.query||game.miniExtracto?(b("0"),game.currentCameraTarget=cameraTargets.whole,game.miniExtracto=game.query=!1,game.spitsMoney=!1,flow.scene.getMeshByName("money out").setEnabled(!1),void game.skeleton.beginAnimation("SpitMoneyAndReceipt",!1,1,function(){flow.scene.getMeshByName("receipt").setEnabled(!0),flow.scene.getMeshByName("money out").setEnabled(!1),m()})):void(game.isDeposit?(game.isDeposit=!1,game.thirdPartyRequired?b("33"):game.transference?b("42"):b("30")):b("10")),l={buttons:["touch r 0","touch r 1","touch r 2","touch r 3"],actions:[e(g),e(g),e(g),e(g)]},d={buttons:["touch l 0","touch r 1","touch r 0"],actions:[e(()=>{b("14"),game.skeleton.beginAnimation("SpitTheDepositedMoney",!1,1,()=>{var n=game.scene.getMeshByName("spitted money");n.setEnabled(!0),n.actionManager=new BABYLON.ActionManager(game.scene),n.actionManager.registerAction(e(()=>{n.actionManager.actions=[],n.setEnabled(!1),game.skeleton.beginAnimation("TakeTheDepositedMoney",!1,1,()=>{y()})}))})}),e(()=>{b("30")}),e(()=>{game.spitsMoney=!1,b("12")})],onCall:function(){game.quantityPanel.setEnabled(!0),game.totalPanel.setEnabled(!0),game.multipliedPanel.setEnabled(!0)},onQuit:function(){game.quantityPanel.setEnabled(!1),game.totalPanel.setEnabled(!1),game.multipliedPanel.setEnabled(!1)}},h={0:{cameraTarget:cameraTargets.whole},14:{cameraTarget:cameraTargets.whole},1:{cameraTarget:cameraTargets.screen},2:{cameraTarget:cameraTargets.screen},3:{buttons:["touch r 1","touch r 2"],actions:[e(function(){b("4")}),e(function(){b("4")})],cameraTarget:cameraTargets.screen},4:{requirePin:!0,hidePin:!0,onInput:c,cameraTarget:cameraTargets.keyboard,onCall:function(){console.log("pin up"),game.skeleton.beginAnimation("PinUp",!1)},onQuit:function(){console.log("pin down"),game.skeleton.beginAnimation("PinDown",!1)}},5:{requirePin:!0,hidePin:!0,onInput:c,cameraTarget:cameraTargets.keyboard},23:{buttons:["touch r 1","touch r 2"],actions:[e(()=>{t()}),e(function(){b("4")})],cameraTarget:cameraTargets.screen},7:{buttons:["touch l 3","touch l 2","touch l 1","touch r 3","touch r 2","touch r 1","touch r 0"],actions:[e(function(){b("8")}),e(function(){game.quickWhithdraw=!0,b("8")}),e(function(){b("28")}),e(function(){b("20")}),e(()=>{game.transference=!0,game.spitsMoney=!1,b("28")}),e(()=>{b("24")}),e(()=>{game.miniExtracto=!0,b("20")})]},8:{buttons:["touch r 0","touch r 1","touch r 2"],actions:[e(function(){b("46")}),e(function(){b("45")}),e(function(){b("47")})]},42:o,11:o,10:{buttons:["touch r 1"],actions:[e(function(){b("11")})]},12:{buttons:["touch r 1","touch r 2"],actions:[e(function(){s(!1)}),e(function(){s(!0)})],onCall:function(){game.quickWhithdraw=!1}},45:l,47:l,16:n,19:{buttons:["touch r 0","touch r 1","touch r 2","touch r 3","touch l 0","touch l 1","touch l 2","touch l 3"],actions:[i,i,i,i,i,i,i,i]},28:{buttons:["touch r 1","touch r 2"],actions:[e(()=>{game.thirdPartyRequired=!0,b("29")}),e(()=>{game.thirdPartyRequired=!1,b("29")})],onCall:function(){game.isDeposit=!0,game.numberOfBills=0}},29:{buttons:["touch r 2","touch r 1"],actions:[r("bs"),r("$")]},33:{buttons:["touch r 0","touch r 1"],actions:[e(()=>y()),e(()=>{game.transference?b("42"):b("30")})],requireAccount:!0,cameraTarget:cameraTargets.keyboard},22:{buttons:["touch r 1","touch r 2"],actions:[e(()=>b("45")),e(()=>b("47"))]},30:{cameraTarget:cameraTargets.whole,onCall:function(){game.scene.getMeshByName("paper money in dollars").setEnabled("$"==game.currency),game.scene.getMeshByName("paper money in bs").setEnabled("bs"==game.currency),game.skeleton.beginAnimation("SpawnMoneyUp",!1,1,()=>{game.scene.getMeshByName("money in hitbox").setEnabled(!0);var n=game.scene.getMeshByName("money in hitbox");n.actionManager=new BABYLON.ActionManager(game.scene),n.actionManager.registerAction(e(()=>{game.numberOfBills++,game.scene.getMeshByName("money in hitbox").setEnabled(!1),n.actionManager.actions=[],game.skeleton.beginAnimation("StickTheMoney",!1,1,()=>{game.quantityPanel.button.textBlock.text=game.numberOfBills+"",game.totalPanel.button.textBlock.text=game.multipliedPanel.button.textBlock.text=100*game.numberOfBills+"","$"==game.currency?b("32"):b("60")})}))})}},32:d,60:d,46:{onCall:function(){game.blocked=!0,setTimeout(()=>{game.blocked=!1,game.cancelFunction()},5e3)}},20:{buttons:["touch r 0","touch r 1","touch r 2"],actions:[e(()=>{b("46")}),e(()=>{game.query=!0,b("45")}),e(()=>{game.query=!0,b("47")})]},24:{requirePin:!0,hidePin:!0,onInput:a,cameraTarget:cameraTargets.keyboard},25:{requirePin:!0,hidePin:!0,onInput:a,cameraTarget:cameraTargets.keyboard},26:n,27:{cameraTarget:cameraTargets.whole,onCall:function(){t(!1)}},57:{buttons:["touch r 1","touch r 2"],actions:[e(()=>y()),e(()=>b("11"))]}},b=function(e){if(flow.currentScreen&&flow.currentScreen.onQuit&&flow.currentScreen.onQuit(),game.goToScreen(e),console.log(e,h[e]),flow.currentScreen=h[e],flow.currentScreen&&flow.currentScreen.cameraTarget?game.currentCameraTarget=flow.currentScreen.cameraTarget:game.currentCameraTarget=cameraTargets.screen,flow.currentScreen&&(flow.currentScreen.name=e),function(){for(var e=0;e<4;e++){var n;(n=flow.scene.getMeshByName("touch r "+e)).actionManager&&(n.actionManager.actions=[]),(n=flow.scene.getMeshByName("touch l "+e)).actionManager&&(n.actionManager.actions=[])}}(flow.scene),h[e]){if(h[e].buttons)for(var n=0;n<h[e].buttons.length;n++){var a=flow.scene.getMeshByName(h[e].buttons[n]);a.actionManager=new BABYLON.ActionManager(flow.scene),a.actionManager.registerAction(h[e].actions[n])}h[e].requirePin?(game.numbersPanel.setEnabled(!0),game.hidePin=h[e].hidePin,game.numbersPanel.button.textBlock.text="",game.numbersPanel.button.input=""):game.numbersPanel.setEnabled(!1),h[e].requireAmount?(game.amountPanel.setEnabled(!0),game.amountPanel.value=0,game.amountPanel.button.textBlock.text="0.00"):game.amountPanel.setEnabled(!1),h[e].requireAccount?(game.accountPanel.setEnabled(!0),game.accountPanel.button.textBlock.text=""):game.accountPanel.setEnabled(!1),flow.toRemove&&document.removeEventListener("onNumpadInput",flow.toRemove),h[e].onInput&&(flow.toRemove=h[e].onInput,document.addEventListener("onNumpadInput",flow.toRemove)),h[e].onCall&&(console.log("call"),h[e].onCall())}else game.numbersPanel.setEnabled(!1),game.amountPanel.setEnabled(!1),game.accountPanel.setEnabled(!1)},f=function(){p(),b("16")},y=function(){game.atmCode="0000",p(),b("23")},p=function(){game.spitsMoney=!0,game.transference=!1,game.quickWhithdraw=!1,game.miniExtracto=!1},B=function(){game.wrongCode=0,b("6"),setTimeout(()=>{b("0")},5e3),setTimeout(()=>{game.skeleton.beginAnimation("RespawnCard",!1,1,function(){game.wrongCode=0,game.capturedCard=game.isCardInAnimationOver=game.isCardInside=!1})},8e3)};return{initializeChip:function(){game.card.setEnabled(!1),game.isCardInAnimationOver=!1,b("1"),setTimeout(()=>{b("2"),setTimeout(()=>{b("3"),game.isCardInAnimationOver=!0},3e3)},3e3)},cancel:y,goToScreen:b}})();
